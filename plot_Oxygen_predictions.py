import numpy as np
import pickle
import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages
from src import emulator

from matplotlib import rc
rc('font',**{'family':'serif','sans-serif':['Helvetica']})
rc('text', usetex=True)
rc('text.latex', preamble=r'\usepackage{amssymb,bm}')

with PdfPages('figs/plot_Oxygen_predictions.pdf') as pdf:
    # Jet RAA
    fig, ax = plt.subplots(figsize=(7,6))
    baseline = np.load('data/prediction_RAA_jet_Oxygen_baseline.npy')
    ax.fill_between(baseline.T[0], baseline.T[1], baseline.T[2], color='gray', label=r'No quenching', zorder=0)
    ax.fill_between(baseline.T[0], baseline.T[3], baseline.T[4], color='gray', alpha=0.3, zorder=0)
    raa1 = np.load('data/prediction_RAA_jet_Oxygen_0-30%.npy')
    ax.fill_between(raa1.T[0], raa1.T[1], raa1.T[2], color='C3', label=r'OO: 0-30\%')
    ax.fill_between(raa1.T[0], raa1.T[3], raa1.T[4], color='C3', alpha=0.3)
    raa2 = np.load('data/prediction_RAA_jet_Oxygen_30-100%.npy')
    ax.fill_between(raa2.T[0], raa2.T[1], raa2.T[2], color='C0', label=r'OO: 30-100\%')
    ax.fill_between(raa2.T[0], raa2.T[3], raa2.T[4], color='C0', alpha=0.3)
    ax.semilogx(0)
    ax.text(43, 0.685, r'OO/pp @ 5.36 TeV', color='gray', rotation=-0, fontsize=18)
    ax.text(43, 0.65, r'inclusive jets: $R_{ak_t}=0.4$, $|\eta_{\rm jet}|<2.1$', color='gray', rotation=-0, fontsize=18)
    ax.text(43, 0.615, r'EPPS21 + NLO QCD + coherent energy loss', color='gray', rotation=-0, fontsize=18)
    ax.legend(loc=(0.57,0.14), fontsize=18)
    ax.set_ylim(0.6,1.2)
    ax.set_xlim(30,500)
    ax.set_xlabel(r'$p_T^{\rm jet}$ [GeV]', fontsize=20)
    ax.set_ylabel(r'$R_{AA}^{\rm jet}$', fontsize=20)
    ax.set_xticks([30, 40, 50, 100, 500], labels=[30, 40, 50, 100, 500])
    ax.tick_params(axis='both', which='both',  right=True,  top=True,  bottom=True,  direction='in',  labelsize=20)
    ax.minorticks_on()
    plt.tight_layout()
    plt.subplots_adjust(hspace=.0, wspace=.0)
    pdf.savefig(bbox_inches='tight')  
    plt.close()

    # Jet V2
    fig, ax = plt.subplots(figsize=(7,6))
    raa1 = np.load('data/prediction_V2_jet_Oxygen_0-30%.npy')
    ax.semilogx(raa1.T[0],0/raa1.T[0],'k', zorder=1)
    ax.fill_between(raa1.T[0], raa1.T[1], raa1.T[2], color='C3', label=r'OO: 0-30\%')
    ax.fill_between(raa1.T[0], raa1.T[3], raa1.T[4], color='C3', alpha=0.3)
    raa2 = np.load('data/prediction_V2_jet_Oxygen_30-100%.npy')
    ax.fill_between(raa2.T[0], raa2.T[1], raa2.T[2], color='C0', label=r'OO: 30-100\%')
    ax.fill_between(raa2.T[0], raa2.T[3], raa2.T[4], color='C0', alpha=0.3)
    ax.text(33, -0.003, r'OO/pp @ 5.36 TeV', color='gray', rotation=-0, fontsize=18)
    ax.text(33, -0.006, r'inclusive jets: $R_{ak_t}=0.4$, $|\eta_{\rm jet}|<2.1$', color='gray', rotation=-0, fontsize=18)
    ax.text(33, -0.009, r'EPPS21 + NLO QCD + coherent energy loss', color='gray', rotation=-0, fontsize=18)
    ax.legend(fontsize=18)
    ax.set_ylim(-0.01,0.03)
    ax.set_xlim(30,500)
    ax.set_xlabel(r'$p_T^{\rm jet}$ [GeV]', fontsize=20)
    ax.set_ylabel(r'$v_2^{\rm jet}$', fontsize=20)
    ax.set_yticks([-0.01,0,0.01,0.02,0.03], labels=[-0.01,0,0.01,0.02,0.03])
    ax.set_xticks([30, 40, 50, 100, 500], labels=[30, 40, 50, 100, 500])
    ax.tick_params(axis='both', which='both',  right=True,  top=True,  bottom=True,  direction='in',  labelsize=20)
    ax.minorticks_on()
    plt.tight_layout()
    plt.subplots_adjust(hspace=.0, wspace=.0)
    pdf.savefig(bbox_inches='tight')  
    plt.close()

    # hadron RAA
    fig, ax = plt.subplots(figsize=(7,6))
    baseline = np.load('data/prediction_RAA_hadron_Oxygen_baseline.npy')
    ax.fill_between(baseline.T[0], baseline.T[1], baseline.T[2], color='gray', label=r'No quenching', zorder=0)
    ax.fill_between(baseline.T[0], baseline.T[3], baseline.T[4], color='gray', alpha=0.3, zorder=0)
    raa1 = np.load('data/prediction_RAA_hadron_Oxygen_0-30%.npy')
    ax.fill_between(raa1.T[0], raa1.T[1], raa1.T[2], color='C3', label=r'OO: 0-30\%')
    ax.fill_between(raa1.T[0], raa1.T[3], raa1.T[4], color='C3', alpha=0.3)
    raa2 = np.load('data/prediction_RAA_hadron_Oxygen_30-100%.npy')
    ax.fill_between(raa2.T[0], raa2.T[1], raa2.T[2], color='C0', label=r'OO: 30-100\%')
    ax.fill_between(raa2.T[0], raa2.T[3], raa2.T[4], color='C0', alpha=0.3)
    ax.semilogx(0)
    ax.text(12, 0.685, r'OO/pp @ 5.36 TeV', color='gray', rotation=-0, fontsize=16).set_zorder(102)
    ax.text(12, 0.65, r'inclusive charged hadrons: $|\eta_{\rm h^\pm}|<2.1$', color='gray', rotation=-0, fontsize=16).set_zorder(102)
    ax.text(12, 0.615, r'EPPS21 + NLO QCD + coherent energy loss + NPC23', color='gray', rotation=-0, fontsize=16).set_zorder(102)
    ax.legend(loc=(0.57,0.14), fontsize=18).set_zorder(102)
    ax.set_ylim(0.6,1.2)
    ax.set_xlim(10,400)
    ax.set_xlabel(r'$p_T^{\rm h^{\pm}}$ [GeV]', fontsize=20)
    ax.set_ylabel(r'$R_{AA}^{\rm h^\pm}$', fontsize=20)
    ax.set_xticks([10,20,50,100,200,400], labels=[10,20,50,100,200,400])
    ax.tick_params(axis='both', which='both',  right=True,  top=True,  bottom=True,  direction='in',  labelsize=20)
    ax.minorticks_on()
    plt.tight_layout()
    plt.subplots_adjust(hspace=.0, wspace=.0)
    pdf.savefig(bbox_inches='tight')  
    plt.close()

    # hadron V2
    fig, ax = plt.subplots(figsize=(7,6))
    raa1 = np.load('data/prediction_V2_hadron_Oxygen_0-30%.npy')
    ax.semilogx(raa1.T[0],0/raa1.T[0],'k', zorder=1)
    ax.fill_between(raa1.T[0], raa1.T[1], raa1.T[2], color='C3', label=r'OO: 0-30\%')
    ax.fill_between(raa1.T[0], raa1.T[3], raa1.T[4], color='C3', alpha=0.3)
    raa2 = np.load('data/prediction_V2_hadron_Oxygen_30-100%.npy')
    ax.fill_between(raa2.T[0], raa2.T[1], raa2.T[2], color='C0', label=r'OO: 30-100\%')
    ax.fill_between(raa2.T[0], raa2.T[3], raa2.T[4], color='C0', alpha=0.3)
    ax.text(11, -0.003, r'OO/pp @ 5.36 TeV', color='gray', rotation=-0, fontsize=16)
    ax.text(11, -0.006, r'inclusive charged hadrons: $|\eta_{\rm h^\pm}|<2.1$', color='gray', rotation=-0, fontsize=16)
    ax.text(11, -0.009, r'EPPS21 + NLO QCD + coherent energy loss + NPC23', color='gray', rotation=-0, fontsize=16)
    ax.legend(fontsize=18)
    ax.set_ylim(-0.01,0.03)
    ax.set_xlim(30,500)
    ax.set_xlabel(r'$p_T^{\rm jet}$ [GeV]', fontsize=20)
    ax.set_ylabel(r'$v_2^{\rm jet}$', fontsize=20)
    ax.set_yticks([-0.01,0,0.01,0.02,0.03], labels=[-0.01,0,0.01,0.02,0.03])
    ax.set_xticks([10,20,50,100,200,400], labels=[10,20,50,100,200,400])
    ax.tick_params(axis='both', which='both',  right=True,  top=True,  bottom=True,  direction='in',  labelsize=20)
    ax.minorticks_on()
    plt.tight_layout()
    plt.subplots_adjust(hspace=.0, wspace=.0)
    pdf.savefig(bbox_inches='tight')  
    plt.close()

